<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Cakephp Captcha : Captcha implementation for CakePHP 2.2+" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Cakephp Captcha</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/donovan-duplessis/cakephp-captcha">View on GitHub</a>

          <h1 id="project_title">Cakephp Captcha</h1>
          <h2 id="project_tagline">Captcha implementation for CakePHP 2.2+</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/donovan-duplessis/cakephp-captcha/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/donovan-duplessis/cakephp-captcha/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="captcha-support-for-cakephp-22" class="anchor" href="#captcha-support-for-cakephp-22"><span class="octicon octicon-link"></span></a>Captcha support for CakePHP 2.2+</h1>

<p>Generates an image with random alphanumeric characters which requires a human to validate.  This is to prevent automated spam and spam bots.</p>

<p>Features:</p>

<ul>
<li>Multiple captcha types <code>alpha|math</code>
</li>
<li>Supports rotation of text</li>
<li>The image width and height dimensions can be set</li>
<li>The font size can be adjusted</li>
<li>Random monospace fonts are used during generation <code>anonymous|droidsans|ubuntu</code>
</li>
<li>Multiple captchas allowed per form</li>
<li>Theme colour profiles <code>default|random|green|red|blue</code>
</li>
</ul><h2>
<a name="demonstration" class="anchor" href="#demonstration"><span class="octicon octicon-link"></span></a>Demonstration</h2>

<p><a href="http://captcha.baselocker.com">captcha.baselocker.com</a></p>

<p><strong>examples:</strong></p>

<p><img src="http://captcha.baselocker.com/captchas/captcha.jpg" alt="alt captcha" title="Captcha"> 
<img src="http://captcha.baselocker.com/captchas/captcha-2.jpg" alt="alt captcha" title="Captcha"></p>

<h2>
<a name="requirements" class="anchor" href="#requirements"><span class="octicon octicon-link"></span></a>Requirements</h2>

<ul>
<li>PHP version: 5.2+</li>
<li>CakePHP version: 2.0+</li>
</ul><h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Clone or download the component:</p>

<div class="highlight highlight-bash"><pre>git clone git://github.com/donovan-duplessis/cakephp-captcha.git
</pre></div>

<p>Copy the component and behavior into your framework at:</p>

<div class="highlight highlight-bash"><pre><span class="nb">cd </span>cakephp-captcha
cp Controller/Component/CaptchaComponent.php &lt;your-app&gt;/app/Controller/Component/
cp Model/Behavior/CaptchaBehavior.php &lt;your-app&gt;/app/Model/Behavior/
</pre></div>

<p>Copy the fonts into your framework at:</p>

<div class="highlight highlight-bash"><pre>cp -R Lib/Fonts &lt;your-app&gt;/app/Lib/
chmod <span class="m">755</span> &lt;your-app&gt;/app/Lib/Fonts
</pre></div>

<p>GD library needs to be installed for PHP (for dynamic image creation):</p>

<p>Ubuntu</p>

<div class="highlight highlight-bash"><pre>sudo apt-get install php5-gd
</pre></div>

<p>Mac OSX (MacPorts)</p>

<div class="highlight highlight-bash"><pre>sudo port install php5-gd
</pre></div>

<h2>
<a name="errors" class="anchor" href="#errors"><span class="octicon octicon-link"></span></a>Errors</h2>

<p>e.g. "Call to undefined function imagecreatetruecolor ()"</p>

<p>Install php5-gd library as described above</p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Include Captcha behavior in model:<br></p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="nv">$actsAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Captcha'</span><span class="p">);</span>
</pre></div>

<p>Include Captcha component in controller:</p>

<div class="highlight highlight-php"><pre><span class="k">public</span> <span class="nv">$components</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'Captcha'</span><span class="p">);</span>
</pre></div>

<p>To output the captcha image from controller:</p>

<div class="highlight highlight-php"><pre><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Captcha</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">();</span>
</pre></div>

<h2>
<a name="reload-image" class="anchor" href="#reload-image"><span class="octicon octicon-link"></span></a>Reload image</h2>

<p>Refer to sample code (mostly in contacts index view) which refreshes the captcha image via jQuery.</p>

<h2>
<a name="authentication" class="anchor" href="#authentication"><span class="octicon octicon-link"></span></a>Authentication</h2>

<p>If you are using the authentication component, ensure that the captcha action (that generates the image) is granted access.</p>

<h2>
<a name="sample-code" class="anchor" href="#sample-code"><span class="octicon octicon-link"></span></a>Sample Code</h2>

<p>Model Contact.php</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">'AppModel'</span><span class="p">,</span> <span class="s1">'Model'</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">Contact</span> <span class="k">extends</span> <span class="nx">AppModel</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$actsAs</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'Captcha'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="c1">// We will be handling 2 captcha controls on the form</span>
            <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'captcha'</span><span class="p">,</span> <span class="s1">'captcha-2'</span><span class="p">),</span>
            <span class="s1">'error'</span> <span class="o">=&gt;</span> <span class="s1">'Captcha code entered invalid'</span>
        <span class="p">)</span>
    <span class="p">);</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>Controller ContactsController.php</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
<span class="nx">App</span><span class="o">::</span><span class="na">uses</span><span class="p">(</span><span class="s1">'AppController'</span><span class="p">,</span> <span class="s1">'Controller'</span><span class="p">);</span>

<span class="k">class</span> <span class="nc">ContactsController</span> <span class="k">extends</span> <span class="nx">AppController</span> <span class="p">{</span>

    <span class="c1">// Keep track of the two captcha controls, each captcha store/verify</span>
    <span class="c1">// will be kept in its own session variable.</span>
    <span class="k">public</span> <span class="nv">$captchas</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">'captcha'</span><span class="p">,</span> <span class="s1">'captcha-2'</span><span class="p">);</span>

    <span class="k">public</span> <span class="nv">$components</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'Captcha'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'type'</span>   <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'alpha'</span><span class="p">,</span> <span class="s1">'math'</span><span class="p">),</span>
            <span class="s1">'rotate'</span> <span class="o">=&gt;</span> <span class="k">true</span>
            <span class="s1">'theme'</span>  <span class="o">=&gt;</span> <span class="s1">'random'</span>
        <span class="p">),</span>
        <span class="s1">'RequestHandler'</span>
    <span class="p">);</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">captcha</span><span class="p">()</span>  <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">autoRender</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

        <span class="c1">// Retrieve the basename for the image route so that we can</span>
        <span class="c1">// uniquely identify and generate each captcha control.</span>
        <span class="nv">$captcha</span> <span class="o">=</span> <span class="nb">basename</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">[</span><span class="s1">'url'</span><span class="p">][</span><span class="s1">'url'</span><span class="p">],</span> <span class="s1">'.jpg'</span><span class="p">);</span>

        <span class="c1">/// Generate actual captcha image (each image unique per image route)</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Captcha</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="nv">$captcha</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">index</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">RequestHandler</span><span class="o">-&gt;</span><span class="na">isPost</span><span class="p">())</span> <span class="p">{</span>

            <span class="c1">// For each captcha control we need to store the captcha value,</span>
            <span class="c1">// retreived from the session, in the corresponding model field so</span>
            <span class="c1">// that it can be validated.</span>
            <span class="k">foreach</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">captchas</span> <span class="k">as</span> <span class="nv">$field</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Contact</span><span class="o">-&gt;</span><span class="na">setCaptcha</span><span class="p">(</span><span class="nv">$field</span><span class="p">,</span>
                    <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Captcha</span><span class="o">-&gt;</span><span class="na">getCode</span><span class="p">(</span><span class="nv">$field</span><span class="p">));</span>
            <span class="p">};</span>

            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Contact</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="o">-&gt;</span><span class="na">data</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Contact</span><span class="o">-&gt;</span><span class="na">validates</span><span class="p">())</span> <span class="p">{</span>
                <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Session</span><span class="o">-&gt;</span><span class="na">setFlash</span><span class="p">(</span><span class="s1">'Captcha codes validated successfully'</span><span class="p">,</span>
                    <span class="s1">'flash_good'</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1">// Store configured captcha controls in view for rendering</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">'captcha_fields'</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">captchas</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<p>Route Config/routes.php</p>

<div class="highlight highlight-php"><pre><span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span><span class="s1">'/img/captcha.jpg'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'contacts'</span><span class="p">,</span> <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'captcha'</span><span class="p">));</span>
<span class="nx">Router</span><span class="o">::</span><span class="na">connect</span><span class="p">(</span><span class="s1">'/img/captcha-2.jpg'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'contacts'</span><span class="p">,</span> <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'captcha'</span><span class="p">));</span>
</pre></div>

<p>View Contacts/index.ctp</p>

<div class="highlight highlight-php"><pre><span class="o">&lt;?</span><span class="nx">php</span>
    <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Form</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(</span><span class="s1">'Contact'</span><span class="p">);</span>
    <span class="c1">// For each configured captcha control, render the captcha image +</span>
    <span class="c1">// text input element + reload link</span>
    <span class="k">foreach</span><span class="p">(</span><span class="nv">$captcha_fields</span> <span class="k">as</span> <span class="nv">$index</span> <span class="o">=&gt;</span> <span class="nv">$captcha</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">image</span><span class="p">(</span><span class="nv">$captcha</span> <span class="o">.</span> <span class="s1">'.jpg'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$captcha</span><span class="p">));</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Html</span><span class="o">-&gt;</span><span class="na">link</span><span class="p">(</span><span class="s1">'reload image &amp;#x21bb;'</span><span class="p">,</span> <span class="s1">'#'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'class'</span> <span class="o">=&gt;</span> <span class="s1">'reload'</span><span class="p">,</span> <span class="s1">'escape'</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">));</span>
        <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Form</span><span class="o">-&gt;</span><span class="na">input</span><span class="p">(</span><span class="nv">$captcha</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'label'</span> <span class="o">=&gt;</span> <span class="s1">'Captcha'</span><span class="p">,</span> <span class="s1">'value'</span> <span class="o">=&gt;</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'tabindex'</span> <span class="o">=&gt;</span> <span class="nv">$index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">echo</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">Form</span><span class="o">-&gt;</span><span class="na">end</span><span class="p">(</span><span class="s1">'Submit'</span><span class="p">);</span>
<span class="cp">?&gt;</span><span class="x"></span>
</pre></div>

<h2>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h2>

<ul>
<li>Licensed under The MIT License</li>
<li>Redistributions of files must retain the above copyright notice.</li>
<li><a href="http://opensource.org/licenses/MIT">http://opensource.org/licenses/MIT</a></li>
</ul><h2>
<a name="copyright" class="anchor" href="#copyright"><span class="octicon octicon-link"></span></a>Copyright</h2>

<p>Copyright (C) Donovan du Plessis, <a href="mailto:donovan@binarytrooper.com">donovan@binarytrooper.com</a></p>

<h2>
<a name="contributors" class="anchor" href="#contributors"><span class="octicon octicon-link"></span></a>Contributors</h2>

<ul>
<li>Adriano Luís Rocha (ALR), <a href="https://github.com/adrianoluis">adrianlouis</a>
</li>
<li>Yanosh Kunsh (YLK), <a href="https://github.com/yanosh-kunsh">yanosh-kunsh</a>
</li>
</ul><h2>
<a name="changelog" class="anchor" href="#changelog"><span class="octicon octicon-link"></span></a>Changelog</h2>

<h5>
<a name="18-jun-25-2014" class="anchor" href="#18-jun-25-2014"><span class="octicon octicon-link"></span></a>1.8 [Jun 25, 2014]</h5>

<ul>
<li>Add support for theme colour configurations</li>
<li>Add support for multiple captch types <code>alpha|math</code>
</li>
</ul><h5>
<a name="17-jun-24-2014" class="anchor" href="#17-jun-24-2014"><span class="octicon octicon-link"></span></a>1.7 [Jun 24, 2014]</h5>

<ul>
<li>Output image data in repsonse body correctly <code>(YLK)</code>
</li>
</ul><h5>
<a name="16-jun-04-2014" class="anchor" href="#16-jun-04-2014"><span class="octicon octicon-link"></span></a>1.6 [Jun 04, 2014]</h5>

<ul>
<li>Add support for multiple captchas per form <code>(mubasshir request)</code>
</li>
</ul><h5>
<a name="15-aug-05-2013" class="anchor" href="#15-aug-05-2013"><span class="octicon octicon-link"></span></a>1.5 [Aug 05, 2013]</h5>

<ul>
<li>Add reload captcha image implementation to contacts sample code</li>
</ul><h5>
<a name="14-jun-19-2013" class="anchor" href="#14-jun-19-2013"><span class="octicon octicon-link"></span></a>1.4 [Jun 19, 2013]</h5>

<ul>
<li>Add initialize method to component to set correct image response type and body</li>
<li>Refactor readme document and script comments</li>
</ul><h5>
<a name="13-oct-25-2012" class="anchor" href="#13-oct-25-2012"><span class="octicon octicon-link"></span></a>1.3 [Oct 25, 2012]</h5>

<ul>
<li>Set font path to Lib/Fonts (ALR)</li>
<li>Access Model reference correctly in Behavior <code>(ALR)</code>
</li>
</ul><h5>
<a name="12-oct-17-2012" class="anchor" href="#12-oct-17-2012"><span class="octicon octicon-link"></span></a>1.2 [Oct 17, 2012]</h5>

<ul>
<li>Set component and behavior to framework 2.0 compliant <code>(ALR)</code>
</li>
</ul><h5>
<a name="11-apr-18-2012" class="anchor" href="#11-apr-18-2012"><span class="octicon octicon-link"></span></a>1.1 [Apr 18, 2012]</h5>

<ul>
<li>Add character limit configuration to component</li>
<li>Initial default configuration settings in Behavior</li>
<li>Refactor code and readme document</li>
</ul><h5>
<a name="10-mar-29-2012" class="anchor" href="#10-mar-29-2012"><span class="octicon octicon-link"></span></a>1.0 [Mar 29, 2012]</h5>

<ul>
<li>Initial Version</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Cakephp Captcha maintained by <a href="https://github.com/donovan-duplessis">donovan-duplessis</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
